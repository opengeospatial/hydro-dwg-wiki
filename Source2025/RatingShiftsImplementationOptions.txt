%META:TOPICINFO{author="PaulSheahan" comment="reprev" date="1385074349" format="1.1" reprev="6" version="6"}%
%META:TOPICPARENT{name="RatingShifts"}%
---+ 
---+ Rating Shifts Implementation Options

%TOC%

<br /> Implementation of Stage and Time shifts in the RGS conversion model. Refer concepts investigation: [[RatingsShiftsQuebec][http://external.opengis.org/twiki_public/HydrologyDWG/RatingsShiftsQuebec]]

For the purpose of this document, a Rating Shift is a compounding of the concepts the WMO terms stage shift and time shift.
---++ What is a rating shift

In effect, a rating shift conversion is a conversion that is used to modify a rating table conversion. It is a conversion that modifies the impact of another conversion.

In implementation, a rating shift conversion is a conversion that is applied as part of a conversion chain.
---++ Calculation of flow using shifts in a chained conversion

<a href="http://external.opengis.org/twiki_public/pub/HydrologyDWG/RatingShiftsImplementationOptions/RatingShifts.chainedConversion.png" target="_blank"><img alt="RatingShifts.chainedConversion.png" height="520" src="%ATTACHURL%/RatingShifts.chainedConversion.png" title="RatingShifts.chainedConversion.png" width="535" /></a>
---++ Discharge Rating : A RGS Conversion

The conversion of flow to stage is the primary use case of RGS conversions. The diagram below shows the basic element of time based application of one or more conversion tables.<br /> In this diagram, three rating tables are defined and each table has a single application start time defined.

.

<a href="http://external.opengis.org/twiki_public/pub/HydrologyDWG/RatingShiftsImplementationOptions/RGS.Conversion.Rating.png" target="_blank"><img alt="" height="340" src="%ATTACHURL%/RGS.Conversion.Rating.png" width="560" /></a>

---++ Rating Shift : A RGS Conversion

In the period between rating changes there is often a need to 'tweak' the rating relationship by small amounts. There may be one or many tweaks of the relationship applied in the course of the ratings application period. There is a need to interpolate the tweaking between tweak definition points. Tweaking is equivalent to the release of a new rating table with very minor change and a phased change between the rating tables. A tweak definition may result from a single gauging observation that deviates from the existing rating more than the allowed amount.

A rating shift is a conversion table that is used to determine the amount of stage correction that is applied to the 'computed gage height' to determine the 'effective gage height'. See also the investigation for details of interpolating between shifts RatingsShiftsQuebec.

There may be zero or many shifts defined for a rating period.

<a href="http://external.opengis.org/twiki_public/pub/HydrologyDWG/RatingShiftsImplementationOptions/RGS.Conversion.Shift.png" target="_blank"><img alt="RGS.Conversion.Shift.png" height="351" src="%ATTACHURL%/RGS.Conversion.Shift.png" title="RGS.Conversion.Shift.png" width="535" /></a>
---+++ Relationship between Ratings and Shifts

In terms of the calculation processes for deriving flow from stage there is no direct correction between ratings and shifts. The two conversions are applied independently in the work flow process.

In terms of the full definition and interpolation of shifts there is an implicit relationship between ratings and shifts.

A family of shift tables relates to single period of application of a rating table. The diagram below shows how a number of shift tables may apply to two rating tables.

<a href="http://external.opengis.org/twiki_public/pub/HydrologyDWG/RatingsShiftsQuebec/Ratings_and_Shifts_-_relationship.jpg" target="_blank"><img alt="" height="375" src="%PUBURL%/HydrologyDWG/RatingsShiftsQuebec/Ratings_and_Shifts_-_relationship.jpg" width="532" /></a>

The definition of the shift tables includes the date and time they apply from and actual shift amounts. There are two assumptions made in applying the shifts across the full period of the rating:
   * The shift at the start of the rating table period is zero for all stage values
   * The shift at the end of the rating table period is that same as the previous shift.
These two assumptions mean that to fully apply shifts, definition of shift tables and periods is required plus two pieces of additional information:
   * Date and time of the start of the rating period
   * Date and Time of the end of the rating period.
The diagram below, effective shift definition, illustrates this. In this diagram there is an implied shift table of '0', that is applied at the start of the rating period. At the end of the rating period, shift table three is reapplied. This has the effect of causing table threes definition being applied without interpolation.

.<a href="http://external.opengis.org/twiki_public/pub/HydrologyDWG/RatingShiftsImplementationOptions/RGS.EffectiveShiftDefinition.png" target="_blank"><img alt="" height="500" src="%ATTACHURL%/RGS.EffectiveShiftDefinition.png" width="756" /></a>

---+ Modelling shifts in WaterML.P2

There are two paradigms for modelling shifts under consideration, each will enable the correct application of shifts in an information system and each has their complexities and upsides.

Modelling paradigms:
   1 Model System implementation
   1 Model as two separate conversions
   1 Hybrid - Enable ConversionApplicationtime to refer to conversion of different From and To parameters
---++ Model : system implementation

This approach requires a link between a table and the shifts conversion defintion. There is a shift conversion definition for each rating table. THis may lead to bery bulking an complex WaterML.P2 documents.

The approach enables some of the process / relationship the is implemented when shifts are used in a system to be represented in the model and data.

<a href="http://external.opengis.org/twiki_public/pub/HydrologyDWG/RatingShiftsImplementationOptions/ImplementationSystem.png" target="_blank"><img alt="" height="699" src="%ATTACHURL%/ImplementationSystem.png" width="594" /></a>

---++ Model : Two conversions
---++++++ <span style="color: #000000; font-size: small; line-height: 22px;">This approach is simplistix and treats both the rating and shift conversion as unretaled conversions. To some extent this approach is in line with rgs-24:</span><i style="color: #000000; font-size: small; line-height: 22px;">"We supply conversion information that is able to be used in simple or complex conversion chains. Communication of information that defines the 'chain conversion process' or 'work flow' of simple or complex chain conversions in not in scope. ".</i>

Consideration should be given to the preservation of shift table identifies between sources system and WML2.P2 documents under this model.

<a href="http://external.opengis.org/twiki_public/pub/HydrologyDWG/RatingShiftsImplementationOptions/ImplementationTwoConversions.png" target="_blank"><img alt="" height="699" src="%ATTACHURL%/ImplementationTwoConversions.png" width="636" /></a>

---++ Model : Hybrid - One period, two paramter groups

<a href="http://external.opengis.org/twiki_public/pub/HydrologyDWG/RatingShiftsImplementationOptions/ImplmentationOnePeriodTwoConversion.png" target="_blank"><img alt="" height="688" src="%ATTACHURL%/ImplmentationOnePeriodTwoConversion.png" width="741" /></a>

*Hybrid model - Pros and Cons*

The primary con is that most existing information systems have a one to one relationship between conversion period and conversion tables of the same From and To parameters. For these systems to ingest ratings where a conversion period contains multiple From and To parameters there will be a need to disaggregate the information.

There a significant advantages to transfer document simplicity by allowing a conversion period to refer to multiple parameter From.To combinations. There is also a significant advantage to the application of USGS shifts though the use of this model. The actual shift being applied relies on the flow rating start and end dates as well as the shift application dates. By compounding this information into a single period of application table, if it is possible to find all the information required in one place for computing effective shift. This is a significant advantage for using the information compared to the options that require a different conversion period definition for each conversion table.

-- Main.PaulSheahan - 20 Sep 2013

%META:FILEATTACHMENT{name="RatingShifts.chainedConversion.pptx" attachment="RatingShifts.chainedConversion.pptx" attr="" comment="" date="1380843481" path="RatingShifts.chainedConversion.pptx" size="147581" user="PaulSheahan" version="2"}%
%META:FILEATTACHMENT{name="RatingShifts.chainedConversion.png" attachment="RatingShifts.chainedConversion.png" attr="" comment="" date="1379641393" path="RatingShifts.chainedConversion.png" size="237236" user="PaulSheahan" version="1"}%
%META:FILEATTACHMENT{name="RGS.Conversion.Rating.png" attachment="RGS.Conversion.Rating.png" attr="" comment="" date="1379642108" path="RGS.Conversion.Rating.png" size="60452" user="PaulSheahan" version="1"}%
%META:FILEATTACHMENT{name="RGS.Conversion.Shift.png" attachment="RGS.Conversion.Shift.png" attr="" comment="" date="1379643034" path="RGS.Conversion.Shift.png" size="74190" user="PaulSheahan" version="1"}%
%META:FILEATTACHMENT{name="RGS.Ratings.And.Shifts.png" attachment="RGS.Ratings.And.Shifts.png" attr="" comment="" date="1379643689" path="RGS.Ratings.And.Shifts.png" size="108903" user="PaulSheahan" version="1"}%
%META:FILEATTACHMENT{name="RGS.EffectiveShiftDefinition.png" attachment="RGS.EffectiveShiftDefinition.png" attr="" comment="" date="1379645507" path="RGS.EffectiveShiftDefinition.png" size="90225" user="PaulSheahan" version="1"}%
%META:FILEATTACHMENT{name="ImplementationSystem.png" attachment="ImplementationSystem.png" attr="" comment="" date="1379647738" path="ImplementationSystem.png" size="37114" user="PaulSheahan" version="1"}%
%META:FILEATTACHMENT{name="ImplementationTwoConversions.png" attachment="ImplementationTwoConversions.png" attr="" comment="" date="1379647750" path="ImplementationTwoConversions.png" size="38295" user="PaulSheahan" version="1"}%
%META:FILEATTACHMENT{name="ImplmentationOnePeriodTwoConversion.png" attachment="ImplmentationOnePeriodTwoConversion.png" attr="" comment="" date="1380243667" path="ImplmentationOnePeriodTwoConversion.png" size="65649" user="PaulSheahan" version="1"}%
%META:TOPICMOVED{by="PaulSheahan" date="1385073586" from="HydrologyDWG.RatingShiftsImplementation" to="HydrologyDWG.RatingShiftsImplementationOptions"}%
